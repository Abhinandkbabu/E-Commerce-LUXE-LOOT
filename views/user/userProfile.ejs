<%- include('../layouts/userHeader');  %>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.8/umd/popper.min.js" integrity="sha512-TPh2Oxlg1zp+kz3nFA0C5vVC6leG/6mm1z9+mA81MI5eaUVqasPLO8Cuk4gMF4gUfP5etR73rgU/8PNMsSesoQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<style>

.main-body {
    padding: 15px;
}

.nav-link {
    color: #4a5568;
}
.card {
    box-shadow: 0 1px 3px 0 rgba(0,0,0,.1), 0 1px 2px 0 rgba(0,0,0,.06);
}

.card {
    position: relative;
    display: flex;
    flex-direction: column;
    min-width: 0;
    word-wrap: break-word;
    background-color: #fff;
    background-clip: border-box;
    border: 0 solid rgba(0,0,0,.125);
    border-radius: .25rem;
}

.card-body {
    flex: 1 1 auto;
    min-height: 1px;
    padding: 1rem;
}

.gutters-sm {
    margin-right: -8px;
    margin-left: -8px;
}

.gutters-sm>.col, .gutters-sm>[class*=col-] {
    padding-right: 8px;
    padding-left: 8px;
}
.mb-3, .my-3 {
    margin-bottom: 1rem!important;
}

.bg-gray-300 {
    background-color: #e2e8f0;
}
.h-100 {
    height: 100%!important;
}
.shadow-none {
    box-shadow: none!important;
}
</style>
<div class="container mt-5" style="min-height: 70vh;">

    <div class="row gutters-sm">
      <div class="col-md-4 d-none d-md-block">
        <div class="card">
          <div class="card-body">
            <nav class="nav flex-column nav-pills nav-gap-y-1">
              <a href="#profile" data-toggle="tab" class="nav-item nav-link has-icon nav-link-faded active">
                <i class="fa-solid fa-user"></i> Profile Information
              </a>
              <a href="#account" data-toggle="tab" class="nav-item nav-link has-icon nav-link-faded">
                <i class="fa-solid fa-key"></i> Change Password
              </a>
              <a href="#security" data-toggle="tab" class="nav-item nav-link has-icon nav-link-faded">
                <i class="fa-solid fa-address-card"></i> Manage Address
              </a>
              <a href="#notification" data-toggle="tab" class="nav-item nav-link has-icon nav-link-faded">
                <i class="fa-solid fa-share-nodes"></i> Refer & Earn
              </a>
              <!-- <a href="#billing" data-toggle="tab" class="nav-item nav-link has-icon nav-link-faded">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-credit-card mr-2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>Billing
              </a> -->
            </nav>
          </div>
        </div>
      </div>
      <div class="col-md-8">
        <div class="card">
          <div class="card-header border-bottom mb-3 d-flex d-md-none">
            <ul class="nav nav-tabs card-header-tabs nav-gap-x-1" role="tablist">
              <li class="nav-item">
                <a href="#profile" data-toggle="tab" class="nav-link has-icon active"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></a>
              </li>
              <li class="nav-item">
                <a href="#account" data-toggle="tab" class="nav-link has-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-settings"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg></a>
              </li>
              <li class="nav-item">
                <a href="#security" data-toggle="tab" class="nav-link has-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-shield"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg></a>
              </li>
              <li class="nav-item">
                <a href="#notification" data-toggle="tab" class="nav-link has-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bell"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg></a>
              </li>
              <li class="nav-item">
                <a href="#billing" data-toggle="tab" class="nav-link has-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-credit-card"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg></a>
              </li>
            </ul>
          </div>
          <div class="card-body tab-content">
            <div class="tab-pane active" id="profile" style="width: 550px;">
                <h6>USER DETAILS</h6>
              <hr>
                <div class="row">
                    <div class="col-md-6">
                      <div>
                        
                        <div class="d-flex mt-2">
                            <h6 class="me-2">Name :</h6>
                            <h6 class="fw-lighter" id="userProfileName"><%= userdata.Name %></h6>
                        </div>
                        <div class="d-flex mt-2">
                            <h6 class="me-2">Email :</h6>
                            <h6 class="fw-lighter"><%= userdata.Email %></h6>
                        </div>
                        <div class="d-flex mt-2">
                            <h6 class="me-2">User Id :</h6>
                            <h6 class="fw-lighter"><%= userdata.Email %></h6>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <form>
                        <div class="form-group m-2">
                          <label for="inputName" class="form-label">Edit Name:</label>
                          <input type="text" class="form-control" id="inputName" value="<%= userdata.Name %>" oninput="validateinputName()" disabled>
                          <div class="invalid-feedback" id="nameError"></div>
                        </div>
                        <!-- <div class="form-group m-2">
                          <label for="exampleInputEmail1">Email address</label>
                          <input type="email" class="form-control" id="exampleInputEmail1" placeholder="<%= userdata.Email %>" disabled>
                        </div> -->
                        <button type="button" class="btn btn-info edit-button ms-2"><i class="fa-solid fa-pen-to-square"></i></button>
                        <button type="submit" class="btn btn-default save-button btn-success ms-2" style="display: none;"><i class="fa-solid fa-floppy-disk"></i></button>
                      </form>
                    </div>
                  </div>
            </div>
            <div class="tab-pane" id="account" style="width: 50vh;">
              <h6>PASSWORD SETTINGS</h6>
              <hr>
              <form>
                <div class="form-group">
                  <label for="inputName">Password</label>
                  <input type="password" class="form-control" name="Password"  id="password" required oninput="validateExistingPassword()">
                </div>
                <div class="form-group">
                  <label for="exampleInputEmail1">New Password</label>
                  <input type="password" class="form-control" name="Password"  id="new-password" required oninput="validatePassword()">
                </div>
                <div class="form-group">
                  <label for="exampleInputEmail1">Confirm New Password</label>
                  <input type="password" class="form-control" name="ConfirmPassword" id="repeat-password" required oninput="validateRepeatPassword()">
                </div>
                 <div >
                    <span id="error" class="text-warning"></span>
                 </div>
              <button type="submit" class="btn btn-default btn-success update-password"><i class="fa-solid fa-floppy-disk"></i></button>
              </form>
            </div>
            <div class="tab-pane" id="security" style="width: 70vh;">
              <h6>ADDRESS SETTINGS</h6>
              <hr>
              <div><button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                Add Address
              </button></div>
            <% userdata.Address.forEach(function(address, index) { %>
                <div class="shadow p-3">
                    
                    <!-- Display address details -->
                    <p><strong>Name:</strong> <%= address.name %></p>
                    <p><strong>Address Lane:</strong> <%= address.addressLane %></p>
                    <p><strong>Locality:</strong> <%= address.locality %></p>
                    <p><strong>City:</strong> <%= address.city %></p>
                    <p><strong>Pincode:</strong> <%= address.pincode %></p>
                    <p><strong>State:</strong> <%= address.state %></p>
                    <p><strong>Mobile:</strong> <%= address.mobile %></p>
                    <div>
                        <button class="btn btn-primary btn-sm edit-address-btn" data-bs-toggle="modal" data-bs-target="#editAddressModal" data-address-index="<%= index %>" onclick="editAddress('<%= JSON.stringify(userdata) %>', '<%= index %>')"><i class="fa-solid fa-pen-to-square" style="color: #ffffff;"></i></button>

                        <button class="btn btn-danger btn-sm" onclick="deleteAddress('<%= userdata._id %>', '<%= index %>')"><i class="fa-solid fa-trash" style="color: #ffffff;"></i></button>
                    </div>
                </div>
            <% }); %>
            </div>
            <div class="tab-pane" id="notification">
              <h6>REFFER & EARNINGS</h6>
              <hr>
              <form id="referalEmailForm">
                <div class="form-group">
                    <div class="d-flex">
                        <label class="">EARNINGS : </label> <label class=" text-muted " >500</label>
                    </div>
                  <div class="custom-control custom-checkbox mt-3">
                    <span>Share Your Referal link Through Email</span>
                    <input type="text" class="form-control" id="referalMail" name="Email" placeholder="Enter Your Friends Email " oninput="validatereferalEmail(this)" >
                  </div>
                  <div class="custom-control custom-checkbox">
                   <button class="btn btn-success mt-1" type="submit" id="referalFormbtn" disabled><i class="fa-solid fa-paper-plane" style="color: #ffffff;"></i></button>
                  </div>
                </div>
              </form>
            </div>
            <div class="tab-pane" id="billing">
              <h6>BILLING SETTINGS</h6>
              <hr>
              <form>
                <div class="form-group">
                  <label class="d-block mb-0">Payment Method</label>
                  <div class="small text-muted mb-3">You have not added a payment method</div>
                  <button class="btn btn-info" type="button">Add Payment Method</button>
                </div>
                <div class="form-group mb-0">
                  <label class="d-block">Payment History</label>
                  <div class="border border-gray-500 bg-gray-200 p-3 text-center font-size-sm">You have not made any payment.</div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>


<!-- Add Address modal -->
<div class="modal fade " id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">Add Address</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-2">
          <form id="addressForm">
            <div class="mb-1">
                <label for="name" class="form-label">Name:</label>
                <input type="text" class="form-control" id="name" name="name" oninput="validateName()">
                <div class="invalid-feedback" id="nameError"></div>
            </div>
            <div class="mb-1">
                <label for="addressLane" class="form-label">Address Lane:</label>
                <input type="text" class="form-control" id="addressLane" name="addressLane" oninput="validateAddressLane()">
                <div class="invalid-feedback" id="addressLaneError"></div>
            </div>
            <div class="mb-1">
                <label for="locality" class="form-label">Locality:</label>
                <input type="text" class="form-control" id="locality" name="locality" oninput="validateLocality()">
                <div class="invalid-feedback" id="localityError"></div>
            </div>
            <div class="mb-1">
                <label for="city" class="form-label">City:</label>
                <input type="text" class="form-control" id="city" name="city" oninput="validateCity()">
                <div class="invalid-feedback" id="cityError"></div>
            </div>
            <div class="mb-1">
                <label for="district" class="form-label">District:</label>
                <input type="text" class="form-control" id="district" name="district" oninput="validateDistrict()">
                <div class="invalid-feedback" id="districtError"></div>
            </div>
            <div class="mb-1">
                <label for="state" class="form-label">State:</label>
                <input type="text" class="form-control" id="state" name="state" oninput="validateState()">
                <div class="invalid-feedback" id="stateError"></div>
            </div>
            <div class="mb-1">
                <label for="pincode" class="form-label">Pincode:</label>
                <input type="number" class="form-control" id="pincode" name="pincode" oninput="validatePincode()">
                <div class="invalid-feedback" id="pincodeError"></div>
            </div>
            <div class="mb-1">
                <label for="mobile" class="form-label">Mobile:</label>
                <input type="text" class="form-control" id="mobile" name="mobile" oninput="validateMobile()">
                <div class="invalid-feedback" id="mobileError"></div>
            </div>
            <button type="submit" class="btn btn-primary addadress-btn">Submit</button>
        </form>
        </div>
      </div>
    </div>
  </div>
<!-- End Add Address modal -->

<!-- ...............edit address modal................. -->
<div class="modal fade" id="editAddressModal" tabindex="-1" aria-labelledby="editAddressModalLabel" aria-hidden="true">
<div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="editAddressModalLabel">Edit Address</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-2">
            <form id="editAddressForm">
                <input type="hidden" id="editAddressId" name="adddressId">
                <div class="mb-1">
                    <label for="editName" class="form-label">Name:</label>
                    <input type="text" class="form-control" id="editName" name="name" oninput="editvalidateName()">
                    <div class="invalid-feedback" id="editnameError"></div>
                </div>
                <div class="mb-1">
                    <label for="editAddressLane" class="form-label">Address Lane:</label>
                    <input type="text" class="form-control" id="editAddressLane" name="addressLane" oninput="editvalidateAddressLane()">
                    <div class="invalid-feedback" id="editaddressLaneError"></div>
                </div>
                <div class="mb-1">
                    <label for="editLocality" class="form-label">Locality:</label>
                    <input type="text" class="form-control" id="editLocality" name="locality" oninput="editvalidateLocality()">
                    <div class="invalid-feedback" id="editlocalityError"></div>
                </div>
                <div class="mb-1">
                    <label for="editCity" class="form-label">City:</label>
                    <input type="text" class="form-control" id="editCity" name="city" oninput="editvalidateCity()">
                    <div class="invalid-feedback" id="editcityError"></div>
                </div>
                <div class="mb-1">
                    <label for="editDistrict" class="form-label">District:</label>
                    <input type="text" class="form-control" id="editDistrict" name="district" oninput="editvalidateDistrict()">
                    <div class="invalid-feedback" id="editdistrictError"></div>
                </div>
                <div class="mb-1">
                    <label for="editState" class="form-label">State:</label>
                    <input type="text" class="form-control" id="editState" name="state" oninput="editvalidateState()">
                    <div class="invalid-feedback" id="editstateError"></div>
                </div>
                <div class="mb-1">
                    <label for="editPincode" class="form-label">Pincode:</label>
                    <input type="number" class="form-control" id="editPincode" name="pincode" oninput="editvalidatePincode()">
                    <div class="invalid-feedback" id="editpincodeError"></div>
                </div>
                <div class="mb-1">
                    <label for="editMobile" class="form-label">Mobile:</label>
                    <input type="text" class="form-control" id="editMobile" name="mobile" oninput="editvalidateMobile()">
                    <div class="invalid-feedback" id="editmobileError"></div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="saveEditedAddress" onclick="postEditAddress()">Save changes</button>
            
        </div>
    </div>
</div>
</div>
<!-- ...............end edit address modal................. -->

  <script>
    // Function to populate edit address modal with appropriate address values
  // Function to populate edit address modal with appropriate address values
  function editAddress(userDataString, index) {
      var userData = JSON.parse(userDataString); // Convert JSON string back to an object
      var address = userData.Address[index];
      // Now you can use `userData` and `index` as needed in your function
      // For example, populate the modal with the address details
      $('#editAddressId').val(address._id)
      $('#editName').val(address.name);
      $('#editAddressLane').val(address.addressLane);
      $('#editCity').val(address.city);
      $('#editPincode').val(address.pincode);
      $('#editState').val(address.state);
      $('#editMobile').val(address.mobile);
      $('#editLocality').val(address.locality)
      $('#editDistrict').val(address.district)
      $('#editAddressModal').modal('show');
  }
  
  function postEditAddress(){
      var formData = $('#editAddressForm').serialize()
      $.ajax({
              type: 'POST',
              url: '/editAddress', // Replace with your API endpoint URL
              data: formData,
              success: function(response) {
                  // Handle success response
                  Toastify({
                text: response.msg,
                duration: 1000,
                close: false,
                gravity: "bottom",
                position: 'center',
                style: {
                  background: "rgba(147, 250, 165)", // Set the background color with opacity
                  color: "#fff",
                  borderRadius: "15px",
                }
              }).showToast();
                  // Optionally, close the modal or perform other actions
                  $('#editAddressModal').modal('hide');
  
                  $("#messages").load(location.href + " #messages");
              },
              error: function(xhr, status, error) {
                  // Handle error response
                  console.error('Error editing address:', error);
                  // Optionally, display an error message to the user
              }
          });
  }
    </script>

    <script>
        $(document).ready(function() {
    $('#referalEmailForm').submit(function(e) {
        $('#referalFormbtn').prop('disabled', true);
        e.preventDefault(); // Prevent the default form submission
        
        // Serialize form data
        var formData = $(this).serialize();
        
        // Perform AJAX POST request
        $.ajax({
            type: "POST",
            url: "/sendReferalMail",
            data: formData,
            success: function(response) {
                // Handle successful submission
                Swal.fire({
                position: "center",
                icon: response.icon,
                title: response.msg,
                showConfirmButton: false,
                timer: 1500
                });
                $('#referalMail').val('');
                $('#referalFormbtn').prop('disabled', true);
            },
            error: function(xhr, status, error) {
                // Handle error
                console.error("Error:", error);
            }
        });
    });
});


function validatereferalEmail(input){
                    const value = input.value
                    if(value!=""&&value.includes('@')){
                        $('#referalFormbtn').prop('disabled', false);
                    }else{
                        $('#referalFormbtn').prop('disabled', true);
                    }
                }

    </script>
  
  <script src="../../js/profilePageAjax.js"></script>
<%- include('../layouts/userFooter'); %>